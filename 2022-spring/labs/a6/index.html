

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  

  <link rel="shortcut icon" href="/archives/2022-spring/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="/archives/2022-spring/assets/css/just-the-docs-default.css">

  

  
    <script type="text/javascript" src="/archives/2022-spring/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="/archives/2022-spring/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Lab 6 - Networking 102 | Sysadmin DeCal</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Lab 6 - Networking 102" />
<meta name="author" content="Nikhil Jha, Ben Cuan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A course covering the basics of setting up and administering a production-quality Linux server environment." />
<meta property="og:description" content="A course covering the basics of setting up and administering a production-quality Linux server environment." />
<link rel="canonical" href="https://decal.ocf.berkeley.edu/archives/2022-spring/labs/a6/" />
<meta property="og:url" content="https://decal.ocf.berkeley.edu/archives/2022-spring/labs/a6/" />
<meta property="og:site_name" content="Sysadmin DeCal" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Lab 6 - Networking 102" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Nikhil Jha, Ben Cuan"},"description":"A course covering the basics of setting up and administering a production-quality Linux server environment.","headline":"Lab 6 - Networking 102","url":"https://decal.ocf.berkeley.edu/archives/2022-spring/labs/a6/"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<span style="display: none">
  
@import "./support/support";
@import "./color_schemes/";
@import "./modules";
@import "./custom/custom";


</span>
<body>
  <div id="loading" style="height:140%;width:140%;background-color:#ffffff;position:absolute;z-index:1000;left:-20%;top:-20%"></div>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
      <title>Link</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </symbol>
  </svg>
  <div class="side-bar lab-side-bar">
    <div class="site-header">
      <a href="/" class="site-title lh-tight">
        Sysadmin DeCal
      </a>
      <a href="#" id="menu-button" class="site-button">
        <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
      </a>
    </div>
    <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">      
      <button type="button" name="theme-toggle" class="btn theme-btn" onclick="toggleDark()">Toggle Dark Theme</button>
      <ol><li><a href="#overview">Overview</a></li><li><a href="#network-interfaces">Network Interfaces</a><ol><li><a href="#etcnetworkinterfaces">/etc/network/interfaces</a></li><li><a href="#checkpoint">Checkpoint</a></li></ol></li><li><a href="#proc-filesystem">/proc filesystem</a><ol><li><a href="#procnet">/proc/net/</a></li><li><a href="#procsys">/proc/sys/</a></li><li><a href="#checkpoint-1">Checkpoint</a></li></ol></li><li><a href="#arp-configuration">ARP configuration</a></li><li><a href="#dns-configuration">DNS configuration</a><ol><li><a href="#etchosts">/etc/hosts</a></li><li><a href="#etcresolvconf">/etc/resolv.conf</a></li><li><a href="#etcnsswitchconf">/etc/nsswitch.conf</a></li></ol></li><li><a href="#dhcp-client-configuration">DHCP client configuration</a><ol><li><a href="#timing">Timing</a></li></ol></li><li><a href="#sysadmin-commands">Sysadmin commands</a><ol><li><a href="#ifupdown">ifupdown</a></li><li><a href="#mtr">mtr</a></li><li><a href="#iptables">iptables</a></li><li><a href="#checkpoint-2">Checkpoint</a></li></ol></li><li><a href="#-this-is-fine-">üî• This is fine üî•</a><ol><li><a href="#important-note">IMPORTANT NOTE</a></li><li><a href="#setup">Setup</a></li><li><a href="#problem-instructions">Problem Instructions</a></li><li><a href="#debugging-bank">Debugging Bank</a></li></ol></li><li><a href="#net-ninjas-optional">Net Ninjas (Optional)</a></li></ol>

    </nav>
    </div>
  </div>
  <div id="main" class="main">
    <div id="main-content-wrap" class="main-content-wrap">
      
        
      
      <div id="main-content" class="main-content" role="main">
        <h1 style="margin-bottom:0">Lab 6 - Networking 102</h1>
        
        <p>Facilitator: <a href="/staff#lance-mathias">Lance Mathias</a></p>
        
        
        26 min read
        
          <h2 class="no_toc text-delta" id="table-of-contents">
        
        
          <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents
        
        
      </h2>
    

<ol id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#network-interfaces" id="markdown-toc-network-interfaces">Network Interfaces</a>    <ol>
      <li><a href="#etcnetworkinterfaces" id="markdown-toc-etcnetworkinterfaces">/etc/network/interfaces</a></li>
      <li><a href="#checkpoint" id="markdown-toc-checkpoint">Checkpoint</a></li>
    </ol>
  </li>
  <li><a href="#proc-filesystem" id="markdown-toc-proc-filesystem">/proc filesystem</a>    <ol>
      <li><a href="#procnet" id="markdown-toc-procnet">/proc/net/</a>        <ol>
          <li><a href="#procnetdev" id="markdown-toc-procnetdev">/proc/net/dev</a></li>
          <li><a href="#procnettcpudpraw" id="markdown-toc-procnettcpudpraw">/proc/net/[tcp|udp|raw]</a></li>
          <li><a href="#procnetroute" id="markdown-toc-procnetroute">/proc/net/route</a></li>
          <li><a href="#procnetarp" id="markdown-toc-procnetarp">/proc/net/arp</a></li>
          <li><a href="#procnetsnmp" id="markdown-toc-procnetsnmp">/proc/net/snmp</a></li>
        </ol>
      </li>
      <li><a href="#procsys" id="markdown-toc-procsys">/proc/sys/</a>        <ol>
          <li><a href="#procsysnetcore" id="markdown-toc-procsysnetcore">/proc/sys/net/core/</a></li>
          <li><a href="#procsysnetipv4" id="markdown-toc-procsysnetipv4">/proc/sys/net/ipv4/</a></li>
        </ol>
      </li>
      <li><a href="#checkpoint-1" id="markdown-toc-checkpoint-1">Checkpoint</a></li>
    </ol>
  </li>
  <li><a href="#arp-configuration" id="markdown-toc-arp-configuration">ARP configuration</a></li>
  <li><a href="#dns-configuration" id="markdown-toc-dns-configuration">DNS configuration</a>    <ol>
      <li><a href="#etchosts" id="markdown-toc-etchosts">/etc/hosts</a></li>
      <li><a href="#etcresolvconf" id="markdown-toc-etcresolvconf">/etc/resolv.conf</a></li>
      <li><a href="#etcnsswitchconf" id="markdown-toc-etcnsswitchconf">/etc/nsswitch.conf</a></li>
    </ol>
  </li>
  <li><a href="#dhcp-client-configuration" id="markdown-toc-dhcp-client-configuration">DHCP client configuration</a>    <ol>
      <li><a href="#timing" id="markdown-toc-timing">Timing</a></li>
    </ol>
  </li>
  <li><a href="#sysadmin-commands" id="markdown-toc-sysadmin-commands">Sysadmin commands</a>    <ol>
      <li><a href="#ifupdown" id="markdown-toc-ifupdown">ifupdown</a></li>
      <li><a href="#mtr" id="markdown-toc-mtr">mtr</a></li>
      <li><a href="#iptables" id="markdown-toc-iptables">iptables</a></li>
      <li><a href="#checkpoint-2" id="markdown-toc-checkpoint-2">Checkpoint</a></li>
    </ol>
  </li>
  <li><a href="#exercises" id="markdown-toc-exercises">Exercises</a>    <ol>
      <li><a href="#-this-is-fine-" id="markdown-toc--this-is-fine-">üî• This is fine üî•</a>        <ol>
          <li><a href="#important-note" id="markdown-toc-important-note">IMPORTANT NOTE</a></li>
          <li><a href="#setup" id="markdown-toc-setup">Setup</a></li>
          <li><a href="#problem-instructions" id="markdown-toc-problem-instructions">Problem Instructions</a></li>
          <li><a href="#debugging-bank" id="markdown-toc-debugging-bank">Debugging Bank</a></li>
        </ol>
      </li>
      <li><a href="#net-ninjas-optional" id="markdown-toc-net-ninjas-optional">Net Ninjas (Optional)</a></li>
    </ol>
  </li>
</ol><hr />
      <h2 id="overview">
        
        
          <a href="#overview" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview
        
        
      </h2>
    
<p>This lab will go over some concepts of networking and how certain parts of a network stack are implemented and configured in linux systems.  <strong>It is assumed that you are familiar with basic networking concepts such as those presented in <a href="/labs/b5">Lab b5</a>.</strong></p>

<p><strong>Additional information about certain files discussed here can be found in their corresponding <code class="language-plaintext highlighter-rouge">man</code> pages by typing <code class="language-plaintext highlighter-rouge">man &lt;filename&gt;</code>.</strong></p>

<p>As with the previous labs, there will be questions sprinkled throughout- head over to Gradescope to submit your answers to them!</p><hr />
      <h2 id="network-interfaces">
        
        
          <a href="#network-interfaces" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Network Interfaces
        
        
      </h2>
    

<p><strong>Network interfaces represent a point of connection between a computer and a network.</strong>  Typically network interfaces are associated with a physical piece of hardware, like a network interface card.  However, interfaces can also be entirely implemented in software and have no physical counterpart ‚Äì take the loopback interface <code class="language-plaintext highlighter-rouge">lo</code> for example.  <code class="language-plaintext highlighter-rouge">lo</code> is a virtual interface; it simulates a network interface with only software.</p>
      <h3 id="etcnetworkinterfaces">
        
        
          <a href="#etcnetworkinterfaces" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /etc/network/interfaces
        
        
      </h3>
    
<p>Network interface configurations are stored under the <strong>/etc/network/interfaces</strong> file on your system. Here, there is plenty of room for complexity. For example, you can have certain interfaces automatically brought up by hooking them to system boot scripts or specify some interfaces to only be available under certain circumstances, with some of the provided control flow options.</p>

<p>This lab will go over some common configuration keywords, but there is much more to the file. For a detailed page of the features and syntax of the file simply type <code class="language-plaintext highlighter-rouge">man interfaces</code> to pull up the <code class="language-plaintext highlighter-rouge">man</code> page for the file.</p>

<p>Firstly, configurations are logically divided into units known as <strong><a href="https://askubuntu.com/questions/863274/what-is-a-stanza-in-linux-context-and-where-does-the-world-come-from">stanzas</a></strong>.  The <strong>/etc/network/interfaces</strong> file is comprised of zero or more stanzas which begin with <code class="language-plaintext highlighter-rouge">iface</code>,  <code class="language-plaintext highlighter-rouge">mapping</code>, <code class="language-plaintext highlighter-rouge">auto</code>, <code class="language-plaintext highlighter-rouge">allow-</code>, <code class="language-plaintext highlighter-rouge">source</code>, or <code class="language-plaintext highlighter-rouge">source-directory</code>.  For brevity, we will go over the two most commonly used stanzas <code class="language-plaintext highlighter-rouge">auto</code> and <code class="language-plaintext highlighter-rouge">iface</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">auto</code> stanza is fairly simple, its syntax is <code class="language-plaintext highlighter-rouge">auto &lt;iface&gt;</code>.  The <code class="language-plaintext highlighter-rouge">auto</code> stanza flags an interface to be brought up whenever <code class="language-plaintext highlighter-rouge">ifup</code> is run with the <code class="language-plaintext highlighter-rouge">-a</code> option (More on <code class="language-plaintext highlighter-rouge">ifup</code> below). Since system boot scripts use <code class="language-plaintext highlighter-rouge">ifup</code> with the <code class="language-plaintext highlighter-rouge">-a</code> option, these interfaces are brought up during boot.  Multiple <code class="language-plaintext highlighter-rouge">auto</code> stanzas will be executed in the same order as they are written in the file.</p>

<p>The <code class="language-plaintext highlighter-rouge">iface</code> stanzas lets you express complex configurations for individual interfaces by leveraging its features. Its syntax is <code class="language-plaintext highlighter-rouge">iface &lt;iface&gt; &lt;address-family&gt; &lt;method&gt;</code>.  <strong>Let‚Äôs go over some of the arguments the stanza takes.</strong></p>

<p><code class="language-plaintext highlighter-rouge">&lt;address-family&gt;</code> identifies the addressing that the interface will be using. The most common address families that you‚Äôre probably familiar with are:</p>
<ul>
  <li>IPv4 denoted by <code class="language-plaintext highlighter-rouge">inet</code> in the file</li>
  <li>IPv6 denoted by <code class="language-plaintext highlighter-rouge">inet6</code> in the file</li>
</ul>

<p>Address families can be configured via different methods expressed by the <code class="language-plaintext highlighter-rouge">&lt;method&gt;</code> option.  Some common methods you should be familiar with are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">loopback</code> defines this interface as the <a href="https://www.juniper.net/documentation/en_US/junos/topics/concept/interface-security-loopback-understanding.html">loopback</a>.</li>
  <li><code class="language-plaintext highlighter-rouge">dhcp</code> is for interface configuration via a DHCP server.</li>
  <li><code class="language-plaintext highlighter-rouge">static</code> is for static interface configuration.</li>
  <li><code class="language-plaintext highlighter-rouge">manual</code> brings up the interface with <strong>no</strong> default configuration.</li>
</ul>

<p>Methods also have options that let you supply certain configuration parameters.  For example, for the <code class="language-plaintext highlighter-rouge">static</code> method you can additionally use the <code class="language-plaintext highlighter-rouge">address &lt;ip-address&gt;</code> and <code class="language-plaintext highlighter-rouge">netmask &lt;mask&gt;</code> options to specify the static IP address and netwask you want the interface to use.</p>

<p>Moreover, the <code class="language-plaintext highlighter-rouge">iface</code> stanza additionally has its own options compatible with all families and methods.  To present just a few, we have:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">pre-[up|down] &lt;command&gt;</code> runs the given <code class="language-plaintext highlighter-rouge">&lt;command&gt;</code> before the interface is either taken up or down</li>
  <li><code class="language-plaintext highlighter-rouge">post-[up|down] &lt;command&gt;</code> runs the given <code class="language-plaintext highlighter-rouge">&lt;command&gt;</code> after the interface is either taken up or down</li>
</ul>

<p>As a final note, any changes to the configurations done in this file during runtime are <strong>not</strong> applied automatically.  Changes have to be reloaded via calls to <code class="language-plaintext highlighter-rouge">ifupdown</code>, the de facto command suite for interacting with <strong>/etc/network/interfaces</strong>.</p>
      <h3 id="checkpoint">
        
        
          <a href="#checkpoint" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Checkpoint
        
        
      </h3>
    
<p><strong>Question 1a:</strong> Is the result of running <code class="language-plaintext highlighter-rouge">ping</code> enough to determine whether or not you can reach a server? Why or why not?</p>

<p><strong>Question 1b:</strong> Here‚Äôs a quick check for your understanding ‚Äì below is a very common default configuration for <code class="language-plaintext highlighter-rouge">/etc/network/interfaces</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>auto lo
iface lo inet loopback
</code></pre></div></div>

<p>In your own words, explain what this configuration does. What would happen if you deleted these lines and rebooted?</p>

<p><strong>Question 1c:</strong> Write a few stanzas that configure an interface called <code class="language-plaintext highlighter-rouge">test</code> that is brought up on boot and given the following address: <code class="language-plaintext highlighter-rouge">192.168.13.37/16</code>.</p>
      <h2 id="proc-filesystem">
        
        
          <a href="#proc-filesystem" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc filesystem
        
        
      </h2>
    

<p><code class="language-plaintext highlighter-rouge">proc</code> is a <strong>virtual filesystem</strong> that presents runtime system information in a file-like structure.  This file-like interface provides a standardized method for querying and interacting with the kernel, which dumps metrics in the read-only files located in this directory. Using a tool like <code class="language-plaintext highlighter-rouge">cat</code>, you can dynamically read those files at runtime.  But keep in mind, <strong>there are no ‚Äòreal‚Äô files within <code class="language-plaintext highlighter-rouge">proc</code>.</strong></p>
      <h3 id="procnet">
        
        
          <a href="#procnet" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/net/
        
        
      </h3>
    
<p>We will be focusing on certain portions of <code class="language-plaintext highlighter-rouge">proc</code>, the first of which being <strong>/proc/net/</strong>.  This subdirectory in <code class="language-plaintext highlighter-rouge">proc</code> contains information about various parts of the network stack in the form of virtual files.  Many commands, such as netstat, use these files when you run them.</p>
      <h4 id="procnetdev">
        
        
          <a href="#procnetdev" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/net/dev
        
        
      </h4>
    
<p>This file contains information and statistics on network devices.  <code class="language-plaintext highlighter-rouge">ifconfig</code> is an example command that reads from this file.  Take a look below and notice how the information presented in the ifconfig output corresponds to data dumped in <code class="language-plaintext highlighter-rouge">dev</code> on how many bytes and packets have been received or transmitted by an interface.
<img src="https://i.imgur.com/MC03IMA.png" alt="alt text" title="/proc/net/dev" /></p>
      <h4 id="procnettcpudpraw">
        
        
          <a href="#procnettcpudpraw" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/net/[tcp|udp|raw]
        
        
      </h4>
    
<p>The<code class="language-plaintext highlighter-rouge">tcp</code>, <code class="language-plaintext highlighter-rouge">raw</code>, and <code class="language-plaintext highlighter-rouge">udp</code> files each contain metrics on open system sockets for their respective protocols, i.e. reading <code class="language-plaintext highlighter-rouge">tcp</code> displays info on TCP sockets.  As a side note, raw sockets are network sockets that offer a finer degree of control over the header and payload of packets at each network layer as opposed to leaving that responsibility to the kernel.  They are ideal for uses cases that send or receive packets of a type not explicitly supported by a kernel, think ICMP. For additional information check <a href="http://opensourceforu.com/2015/03/a-guide-to-using-raw-sockets/">this article</a> out. These files are read by <code class="language-plaintext highlighter-rouge">ss</code>, <code class="language-plaintext highlighter-rouge">netstat</code>, etc. Check out the example for tcp below.
<img src="https://i.imgur.com/5ETFK84.png" alt="alt text" title="/proc/net/tcp" /></p>
      <h4 id="procnetroute">
        
        
          <a href="#procnetroute" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/net/route
        
        
      </h4>
    
<p>This file contains information about the kernel routing table.  Some commands that use this file include <code class="language-plaintext highlighter-rouge">ip</code> and <code class="language-plaintext highlighter-rouge">netstat</code>. Take a look at how the file is parsed and processed by the <code class="language-plaintext highlighter-rouge">netstat</code> command.</p>

<p><img src="https://i.imgur.com/tD3oKfO.png" alt="alt text" /></p>
      <h4 id="procnetarp">
        
        
          <a href="#procnetarp" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/net/arp
        
        
      </h4>
    
<p>This file contains a dump of the system‚Äôs ARP cache.  The <code class="language-plaintext highlighter-rouge">arp</code> command reads from this file.  For example, look at how closely the output of the <code class="language-plaintext highlighter-rouge">arp</code> command resembles the raw text dumped by the kernel into the file.</p>

<p><img src="https://i.imgur.com/CI7nUJL.png" alt="alt text" /></p>
      <h4 id="procnetsnmp">
        
        
          <a href="#procnetsnmp" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/net/snmp
        
        
      </h4>
    
<p>This file contains statistics intended to be used by SNMP agents, which are a part of the Simple Network Management Protocol (SNMP).  Regardless of whether or not your system is running SNMP, the data in this file is useful for investigating the network stack.  Take the screenshot below for example, examining the fields we see <code class="language-plaintext highlighter-rouge">InDiscards</code> which according to <a href="https://tools.ietf.org/html/rfc1213">RFC 1213</a> indicates packets that are discarded since problems were encountered that prevented their continued processing.  Lack of buffer space is a possible cause of having a high number of discards.  Having a statistic like this one, amonst others, can help pinpoint a network issue.   For additional information on fields please refer to the header file <a href="https://elixir.bootlin.com/linux/v4.4/source/include/net/snmp.h">here</a>.  The image is a bit small so feel free to <strong>right click -&gt; ‚ÄúOpen image in a new tab‚Äù to magnify the output.</strong></p>

<p><img src="https://i.imgur.com/5vomFYZ.png" alt="alt text" /></p>
      <h3 id="procsys">
        
        
          <a href="#procsys" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/sys/
        
        
      </h3>
    
<p>Whereas the files and subdirectories mentioned above are read-only that isn‚Äôt true about the <strong>/proc/sys</strong> subdirectory which contains virtual files that also allow writes.  You can not only query for system runtime parameters but also write new parameters into these files.  This means you have the power to adjust kernel behavior without the need for a reboot or recompilation.</p>

<p><strong>Mind-blowing.</strong></p>

<p>While the <strong>/proc/sys</strong> directory contains a variety of subdirectories corresponding to aspects of the machine, the one we will be focusing on is <strong>/proc/sys/net</strong> which concerns various networking topics. Depending on configurations at the time of kernel compilation, different subdirectories are made available in <strong>/proc/sys/net</strong>, such as <code class="language-plaintext highlighter-rouge">ethernet/</code>, <code class="language-plaintext highlighter-rouge">ipx/</code>, <code class="language-plaintext highlighter-rouge">ipv4/</code>, and etc.  Given the sheer variety of possible configurations, we will confine the scope of this discussion to the most common directories.</p>
      <h4 id="procsysnetcore">
        
        
          <a href="#procsysnetcore" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/sys/net/core/
        
        
      </h4>
    
<p><code class="language-plaintext highlighter-rouge">core/</code> is the first subdirectory that we‚Äôll cover.  As its name implies, it deals with core settings that direct how the kernel interacts with various networking layers.</p>

<p>Now we can go over some specific files in this directory, their functionality, and motivations behind adjusting them.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">message_burst</code> and <code class="language-plaintext highlighter-rouge">message_cost</code>
Both of these parameters take a single integer argument and together control the logging frequency of the kernel.  <code class="language-plaintext highlighter-rouge">message_burst</code> defines entry frequency and <code class="language-plaintext highlighter-rouge">message_cost</code> defines time frequency in seconds. For example, let‚Äôs take a look at their defaults. <code class="language-plaintext highlighter-rouge">message_burst</code> defaults to 10 and <code class="language-plaintext highlighter-rouge">message_cost</code> defaults to 5.   This means the kernel is limited to logging 10 entries every 5 seconds.</p>

    <p>When adjusting the parameters in these two files, a sysadmin must keep in mind that the tradeoff here is between the granularity of the logs and the performance/storage limitations of the system.  Increasing overall logging frequency can translate to a hit to system performance or huge log files eating up disk.  But if logging is too infrequent, parts of the network may fail silently and bugs may become much harder to identify.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">netdev_max_backlog</code>
This file takes one integer parameter that defines the maximum number of packets allowed to queue on a particular interface.</li>
  <li><code class="language-plaintext highlighter-rouge">rmem_default</code> and <code class="language-plaintext highlighter-rouge">rmem_max</code>
These files define the default and maximum buffer sizes for receive sockets, respectively.</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">smem_default</code> and <code class="language-plaintext highlighter-rouge">smem_max</code>
These files define the default and maximum buffer sizes for send sockets, respectively.</p>

    <p>For the above sets of system parameters, adjusting queue lengths have the nice effect of allowing our system to hold more packets and avoid dropping packets due to a fast sender for example.  This boils down to optimizing flow control.  However, there is no such thing as a free lunch.  Increasing queue sizes can only mitigate problems with arrival rates being greater than service rates for so long.  For more information on why that is check out <a href="https://en.wikipedia.org/wiki/Queueing_theory">queueing theory</a>.  Moreover, having many packets stored in long queues also has its own drawback.  Storing packet information isn‚Äôt free and the more packets stored in the queue, the more resources the system needs.  As a result, too many packets may lead to increased <a href="https://en.wikipedia.org/wiki/Paging">paging</a> and ultimately <a href="https://en.wikipedia.org/wiki/Thrashing_(computer_science)">thrashing</a>.  Once again, we have another tradeoff, but this time between flow control and paging.</p>
  </li>
</ul>

<p>As a sysadmin many of the configuration decisions you make will be balancing between two extremes and the optimal point isn‚Äôt hard and fast.  Many times you‚Äôll have to adjust system parameters on a case-by-case basis and, after empirical testing, come to a good point.</p>
      <h4 id="procsysnetipv4">
        
        
          <a href="#procsysnetipv4" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /proc/sys/net/ipv4/
        
        
      </h4>
    
<p><code class="language-plaintext highlighter-rouge">ipv4/</code> is another common subdirectory that contains setting relevant to IPv4.  Often the settings used in this subdirectory are used, in conjunction with other tools, as a security measure to mitigate network attacks or to customize behavior when the system acts as a router.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">icmp_echo_ignore_all</code>
This file configures the system‚Äôs behavior towards ICMP ECHO packets.  This file has two states <code class="language-plaintext highlighter-rouge">0</code> for off and <code class="language-plaintext highlighter-rouge">1</code> for on.  If on, the system will ignore ICMP ECHO packets from every host.</li>
  <li><code class="language-plaintext highlighter-rouge">icmp_echo_ignore_broadcasts</code>
This file is similar to the one above, except turning this parameter on only makes the system ignore ICMP ECHO packets from broadcast and multicast.</li>
</ul>

<p>One argument against disabling ICMP is that it makes obtaining diagnostic information about servers much harder.  The output of tools that rely on ICMP, i.e. <code class="language-plaintext highlighter-rouge">ping</code>, are no longer as useful. On the other hand, allowing ICMP might be a bad idea if your goal is to hide certain machines.  Additionally, ICMP has been used in the past in <a href="https://en.wikipedia.org/wiki/Ping_of_death">DOS attacks</a>.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ip_forward</code>
Turning this parameter on permits interfaces on the system to forward packets.  Take for example, if your computer has two interfaces, each connected to two different subnets, <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code>.  While your machine can individually send and receive traffic to hosts on either network, machines on <code class="language-plaintext highlighter-rouge">A</code> cannot send packets to machines on <code class="language-plaintext highlighter-rouge">B</code> via your machine.  Turning <code class="language-plaintext highlighter-rouge">ip_forward</code> on is the first step to configuring your linux machine to act as a router.  It is common to see this on machines that act as VPN servers, forwarding traffic on behalf of hosts.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">ip_default_ttl</code>
This is a simple file that configures the default TTL (time to live) for outbound IP packets.</li>
  <li><code class="language-plaintext highlighter-rouge">ip_local_port_range</code>
This file takes two integer parameters.  The first integer specifies the lower bound of the range and the second specifies the upper bound.  Together, the two numbers define the range of ports that can be used by TCP or UDP when a local port is needed.  For example, when a socket is instantiated to send a TCP SYN, the port given to the socket is selected by the operating system and lies within the specified range.  The ports in this range are as known as <a href="https://en.wikipedia.org/wiki/Ephemeral_port">ephemeral ports</a>.</li>
  <li><code class="language-plaintext highlighter-rouge">tcp_syn_retries</code>
This file limits the number of times the system re-transmits a SYN packet when attempting to make a connection.  When attempting to connect to either a ‚Äòflaky‚Äô host or over a ‚Äòflaky‚Äô network, setting this number higher might be desirable.  But this comes at the cost of adding additional traffic to the network and potential blocking other processes while waiting for a SYN-ACK that might never come.</li>
  <li><code class="language-plaintext highlighter-rouge">tcp_retries1</code>
This file limits the number of re-transmissions before signaling the network layer about a potential problem with the connection.</li>
  <li><code class="language-plaintext highlighter-rouge">tcp_retries2</code>
This file limits the number of re-transmissions before killing active connections.  This implies the following relationship: <code class="language-plaintext highlighter-rouge">tcp_retries2</code> &gt;= <code class="language-plaintext highlighter-rouge">tcp_retries1</code>.  The two retry values configure how ‚Äòpatient‚Äô your system should be when it comes to waiting on <a href="https://www.extrahop.com/company/blog/2016/retransmission-timeouts-rtos-application-performance-degradation/">RTOs</a>.</li>
</ul>

<p><strong>Additional information on configurable system parameters can be found either at this <a href="https://www.frozentux.net/ipsysctl-tutorial/chunkyhtml/index.html">tutorial</a> or in documentation via <a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">kernel.org</a> or <a href="https://elixir.bootlin.com/linux/v4.4/source/Documentation/networking/ip-sysctl.txt">bootlin</a>.</strong></p>
      <h3 id="checkpoint-1">
        
        
          <a href="#checkpoint-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Checkpoint
        
        
      </h3>
    
<p><strong>Question 2a:</strong> Describe the <code class="language-plaintext highlighter-rouge">tcp_syncookies</code> <code class="language-plaintext highlighter-rouge">sysctl</code> option.  How can we toggle this value on, and when would we want this on?</p>
      <h2 id="arp-configuration">
        
        
          <a href="#arp-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ARP configuration
        
        
      </h2>
    
<p>The entries in the kernel‚Äôs arp cache can be read during system runtime via <strong>/proc/net/arp</strong> as mentioned above.</p>

<p>Additionally, ARP can be configured with persistent static entries.  This typically done via a file.  Batches of static entries can be included in such a file.  The line-by-line format should be <code class="language-plaintext highlighter-rouge">&lt;mac-address&gt; &lt;ip-address&gt;</code>.  To load the file‚Äôs entries into the system‚Äôs ARP cache one can run <code class="language-plaintext highlighter-rouge">arp -f &lt;file&gt;</code>.  Typically the file that holds these entries has the path <strong>/etc/ethers</strong>.</p>

<p>Static ARP entries are cleared from the system ARP cache on reboot, meaning one would have to run the above command on each boot if we wanted the mappings to ‚Äòpersist‚Äô.  To automate the procedure of running the command we can leverage the interface configuration workflow.  Recall that <strong>/etc/network/interfaces</strong> provides the <code class="language-plaintext highlighter-rouge">auto</code> stanza to identify interfaces to be automatically configured on boot.  Used in conjunction with the <code class="language-plaintext highlighter-rouge">iface</code> stanza and its <code class="language-plaintext highlighter-rouge">post-up &lt;command&gt;</code> option, we can execute the <code class="language-plaintext highlighter-rouge">arp -f /etc/ethers</code> command. This effectively has static entries ‚Äòpersist‚Äô by having them added alongside interface configuration during boot.</p>
      <h2 id="dns-configuration">
        
        
          <a href="#dns-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DNS configuration
        
        
      </h2>
    

<p>Some of the DNS configuration files that we will be going over are <strong>/etc/hosts</strong>, <strong>/etc/resolv.conf</strong>, <strong>/etc/nsswitch.conf</strong>.</p>
      <h3 id="etchosts">
        
        
          <a href="#etchosts" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /etc/hosts
        
        
      </h3>
    

<p>This is simple text file that stores static mappings from IP addresses to hostnames.  The format for each line is <code class="language-plaintext highlighter-rouge">&lt;ip-address&gt; &lt;cannonical-hostname&gt; [aliases]</code>.  An example line would be
<code class="language-plaintext highlighter-rouge">31.13.70.36 www.facebook.com fb ZuccBook</code></p>

<p>Thanks to this entry we have mapped <code class="language-plaintext highlighter-rouge">www.facebook.com</code> and any aliases we listed to <code class="language-plaintext highlighter-rouge">31.13.70.36</code>.  A very common example entry is <code class="language-plaintext highlighter-rouge">localhost</code> which also has the aliases <code class="language-plaintext highlighter-rouge">ip6-localhost</code>,<code class="language-plaintext highlighter-rouge">ip6-loopback</code> which explains why running something like <code class="language-plaintext highlighter-rouge">ping localhost</code> or <code class="language-plaintext highlighter-rouge">ping ip6-loopback</code> works. This file is one way to manually define translations for certain hostnames.</p>
      <h3 id="etcresolvconf">
        
        
          <a href="#etcresolvconf" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /etc/resolv.conf
        
        
      </h3>
    
<p>Whereas <strong>/etc/hosts</strong> is for static translations of specific hostnames, many times we want to dynamically resolve names by issuing a query to a name server.  There are usually many nameservers, public or private, available to fufill such a query and deciding which ones to query is the job of <strong>/etc/resolv.conf</strong> amongst other configuration options.</p>

<p><strong>/etc/resolv.conf</strong> is the configuration file for the system resolver which is the entity that communciates with DNS name servers on your machine‚Äôs behalf.  If this file does not exist, queries will default to the name server on your local machine.  This file consists of one <code class="language-plaintext highlighter-rouge">domain</code> or <code class="language-plaintext highlighter-rouge">search</code> lines up to three <code class="language-plaintext highlighter-rouge">nameserver</code> lines and any number of options.  Let‚Äôs dive into the details behind these configuration options.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">domain</code>
Using this option will specific a local domain name.  Short queries, which are queries that don‚Äôt contain any domain identifiers, then have the local domain appended to them during DNS queries.</p>

    <p>To understand this better take <code class="language-plaintext highlighter-rouge">death</code> as one of the machines within the OCF domain, <code class="language-plaintext highlighter-rouge">ocf.berkeley.edu</code>.  One can issue a DNS query for death by typing <code class="language-plaintext highlighter-rouge">dig death.ocf.berkeley.edu</code> but that‚Äôs an awful lot to type.  By specifying <code class="language-plaintext highlighter-rouge">domain ocf.berkeley.edu</code> in <strong>/etc/resolv.conf</strong> the query can be shortened to just <code class="language-plaintext highlighter-rouge">dig death</code>.  In fact, any tool that takes a domain name can now use this shortened version, i.e. <code class="language-plaintext highlighter-rouge">ping death</code>.  This is because your machine‚Äôs resolver is responsible for translating this domain name, and the <code class="language-plaintext highlighter-rouge">domain</code> configuration automatically appends the written domain to these short queries.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">search</code>
The format for this option is <code class="language-plaintext highlighter-rouge">search &lt;search-list&gt;</code>.  Using this options specifies a list of domain names to iterate through when attempting to look up queries.</p>

    <p>Let‚Äôs examine an example use case, imagine we owned two networks <code class="language-plaintext highlighter-rouge">ocf.berkeley.edu</code> and <code class="language-plaintext highlighter-rouge">xcf.berkeley.edu</code> and wanted to query a machine which may either be in either network.  To enable this we can simply add the line <code class="language-plaintext highlighter-rouge">search ocf.berkeley.edu xcf.berkeley.edu</code>.  Queries to resolve a domain name will now append those listed domains in order until a successful DNS response.  If we assume <code class="language-plaintext highlighter-rouge">death</code> is on <code class="language-plaintext highlighter-rouge">ocf.berkeley.edu</code> and another machine, <code class="language-plaintext highlighter-rouge">life</code>, is on <code class="language-plaintext highlighter-rouge">xcf.berkeley.edu</code>, both <code class="language-plaintext highlighter-rouge">dig death</code> and <code class="language-plaintext highlighter-rouge">dig life</code> are now resolved properly thanks to our configuration.</p>
  </li>
</ul>

<p>One thing to note is that <strong><code class="language-plaintext highlighter-rouge">search</code> and <code class="language-plaintext highlighter-rouge">domain</code> are mutually exclusive keywords</strong> and having both defined causes the last instance to take precedence and override earlier entries.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">nameserver</code>
The <code class="language-plaintext highlighter-rouge">nameserver</code> keyword is fairly self explanatory and follows the format of <code class="language-plaintext highlighter-rouge">nameserver &lt;ip-address&gt;</code> where <code class="language-plaintext highlighter-rouge">&lt;ip-address&gt;</code> is the IP address of the intended name server.  One can have up to <code class="language-plaintext highlighter-rouge">MAXNS</code> (default 3) <code class="language-plaintext highlighter-rouge">nameserver</code> entries in this file.  The resolver will query nameservers in the same order as they are written in the file.</li>
</ul>

<p>Following are additional useful configurable options in this file. Options are defined in this format <code class="language-plaintext highlighter-rouge">options &lt;option1&gt; [additional-options]</code>.  Some example options follow below:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ndots</code>
This option, formatted as <code class="language-plaintext highlighter-rouge">ndots:n</code>, configures the threshold,<code class="language-plaintext highlighter-rouge">n</code>, at which  an initial absolute query is made.  Since the default value for this option is 1, any name with at least 1 dot will first be queried as an absolute name before appending domains from <code class="language-plaintext highlighter-rouge">search</code>.  When less than <code class="language-plaintext highlighter-rouge">ndots</code> are present, the queries automatically begin appending elements in <code class="language-plaintext highlighter-rouge">&lt;search-list&gt;</code>.</p>

    <p>Take <code class="language-plaintext highlighter-rouge">death.ocf.berkeley.edu</code> as an example, and  let‚Äôs assume we have the following line <code class="language-plaintext highlighter-rouge">search ocf.berkeley.edu</code> in our configuration.  Running <code class="language-plaintext highlighter-rouge">ping death</code> works because there are 0 dots in <code class="language-plaintext highlighter-rouge">death</code> and the query automatically appends <code class="language-plaintext highlighter-rouge">search</code> elements so that our query becomes <code class="language-plaintext highlighter-rouge">death.ocf.berkeley.edu</code>.  If we instead ran <code class="language-plaintext highlighter-rouge">ping death.</code> the resolver will first issue a query for <code class="language-plaintext highlighter-rouge">death.</code> since it has 1 dot, which fails.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">timeout</code>
This opton is in the format <code class="language-plaintext highlighter-rouge">timeout:n</code> and configures the amount of time <code class="language-plaintext highlighter-rouge">n</code>, in seconds, that a resolver will wait for a response from a name server before retrying the query via another name server.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">attempts</code>
This option is in the format <code class="language-plaintext highlighter-rouge">attempts:n</code> and configures the number of attempts <code class="language-plaintext highlighter-rouge">n</code> that the resolver will make to the entire list of name servers in this file.</p>
  </li>
</ul>
      <h3 id="etcnsswitchconf">
        
        
          <a href="#etcnsswitchconf" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> /etc/nsswitch.conf
        
        
      </h3>
    
<p>With multiple sources of information for resolving hostnames, one can‚Äôt help but wonder how the system decides which sources to query and in what order.  This is answered with the <strong>/etc/nsswitch.conf</strong> file.  It is this file‚Äôs responsibility to list sources of information and configure prioritization between sources.  Similar information sources can be grouped into categories that are referred to as ‚Äòdatabases‚Äô within the context of the file.  The format of the file is as follows: <code class="language-plaintext highlighter-rouge">database [sources]</code>.  While this file provides configuration for a wide array of name-service databases, we will focus on an example relevant to the topic at hand.</p>

<p>The <code class="language-plaintext highlighter-rouge">hosts</code> database configures the behavior of system name resolution.  So far we have introduced two ways to resolve names:</p>
<ol>
  <li>Using entries in <strong>/etc/hosts</strong></li>
  <li>Using a resolver to issue DNS queries to DNS name servers</li>
</ol>

<p>To let the system know about the above two sources of information there are corresponding keywords, <code class="language-plaintext highlighter-rouge">files</code> and <code class="language-plaintext highlighter-rouge">dns</code>, respectively.</p>

<p>We can then configure name resolution by writing the line
<code class="language-plaintext highlighter-rouge">hosts: files dns</code> 
The example syntax above tells the system to first prioritize files before issuing DNS queries.  Naturally, this can be customized to best fit your use case.</p>
      <h2 id="dhcp-client-configuration">
        
        
          <a href="#dhcp-client-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DHCP client configuration
        
        
      </h2>
    
<p>The Internet Systems Consortium DHCP client, known as <em>dhclient</em>, ships with Debian and can be configured via <strong>/etc/dhcp/dhclient.conf</strong>.  Lines in this file are terminated with a semicolon unless contained within brackets, like in the C programming language.  Some potentially interesting parameters to configure include:</p>
      <h3 id="timing">
        
        
          <a href="#timing" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Timing
        
        
      </h3>
    
<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">timeout</code>
This format for this statement is <code class="language-plaintext highlighter-rouge">timeout &lt;time&gt;</code> and defines time to the maximum amount of time, in seconds, that a client will wait for a response from a DHCP server.</p>

    <p>Once a timeout has occured the client will look for static leases defined in the configuration file, or unexpired leases in <strong>/var/lib/dhclient/dhclient.leases</strong>. The client will loop through these leases and if it finds one that appears to be valid, it will use that lease‚Äôs address. If there are no valid static leases or unexpired leases in the lease database, the client will restart the protocol after the defined <code class="language-plaintext highlighter-rouge">retry</code> interval.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">retry</code>
The format for this statement is <code class="language-plaintext highlighter-rouge">retry &lt;time&gt;</code> and configures the amount of time, in seconds, that a client must wait after a timeout before attempting to contact a DHCP server again.</p>
  </li>
</ul>

<p>A client with multiple network interfaces may require different behaviour depending on the interface being configured. Timing parameters and certain declarations can be enclosed in an interface declaration, and those parameters will then be used only for the interface that matches the specified name.</p>

<p>The syntax for an example interface snippet is:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface &lt;iface-name&gt; {
    send host-name "death.ocf.berkeley.edu";
    request subnet-mask, broadcast-address, time-offset, routers,
       domain-search, domain-name, domain-name-servers, host-name;
    [additional-declarations];
}

</code></pre></div></div>

<p>As mentioned above this file also supports defining static leases via a <code class="language-plaintext highlighter-rouge">lease</code> declaration.  Defining such leases may be useful as a fallback in the event that a DHCP server cannot be contacted.</p>

<p>The syntax for a example static lease is:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lease {
#  interface "eth0";
#  fixed-address 192.33.137.200;
#  option host-name "death.ocf.berkeley.edu";
#  option subnet-mask 255.255.255.0;
#  option broadcast-address 192.33.137.255;
#  option routers 192.33.137.250;
#  option domain-name-servers 127.0.0.1;
#  renew 2 2000/1/12 00:00:01;
#  rebind 2 2000/1/12 00:00:01;
#  expire 2 2000/1/12 00:00:01;
#}
</code></pre></div></div>

<p>While the function of most keywords in the above snippet can be inferred from their syntax, more information can be found by simply reading the <code class="language-plaintext highlighter-rouge">man</code> page for this file (<code class="language-plaintext highlighter-rouge">man dhclient.conf</code>).</p>
      <h2 id="sysadmin-commands">
        
        
          <a href="#sysadmin-commands" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sysadmin commands
        
        
      </h2>
    
      <h3 id="ifupdown">
        
        
          <a href="#ifupdown" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ifupdown
        
        
      </h3>
    
<p><code class="language-plaintext highlighter-rouge">ifupdowm</code> is a simple suite of commands for interacting with network interfaces.  The two commands you‚Äôll be using most are <code class="language-plaintext highlighter-rouge">ifup</code> and <code class="language-plaintext highlighter-rouge">ifdown</code> which are relatively self-explanatory.  <code class="language-plaintext highlighter-rouge">ifup</code> brings and interface up and vice versa for <code class="language-plaintext highlighter-rouge">ifdown</code>.  These two commands should be your de facto commands for bringing interfaces up or down since using these commands loads configurations defined in <strong>/etc/network/interfaces</strong>.</p>
      <h3 id="mtr">
        
        
          <a href="#mtr" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> mtr
        
        
      </h3>
    
<p><code class="language-plaintext highlighter-rouge">mtr</code> is a command that combines the functionality of <code class="language-plaintext highlighter-rouge">traceroute</code> with that of <code class="language-plaintext highlighter-rouge">ping</code>. Take a look at <a href="https://linode.com/docs/networking/diagnostics/diagnosing-network-issues-with-mtr/">this article</a> for a good primer for using <code class="language-plaintext highlighter-rouge">mtr</code> and interpreting its output.</p>
      <h3 id="iptables">
        
        
          <a href="#iptables" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> iptables
        
        
      </h3>
    
<p>In favor of not reinventing the wheel please check out these excellent and pretty short articles by <strong>DigitalOcean</strong>, who sponsored this semester‚Äôs offering of the decal by supplying us with VMs.</p>
<ol>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-the-iptables-firewall-works">An Introduction to iptables</a></li>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-iptables-on-ubuntu-14-04">Adding rules</a></li>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules">Deleting rules</a></li>
  <li><a href="https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands">Common rules and tips</a></li>
</ol>
      <h3 id="checkpoint-2">
        
        
          <a href="#checkpoint-2" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Checkpoint
        
        
      </h3>
    
<p><strong>Question 3a:</strong>  If we preferred name resolution be done dynamically rather than using static entries in <strong>/etc/hosts</strong> what file do we need to edit and what is the line we should add?</p>

<p><strong>Question 3b:</strong>  Assume the following information:</p>
<ul>
  <li><strong>/etc/resolv.conf</strong> file has 3 <code class="language-plaintext highlighter-rouge">nameserver</code> entries and a <code class="language-plaintext highlighter-rouge">options timeout:1</code> entry.</li>
  <li>
    <p>A successful DNS response takes 20 ms.</p>

    <p>You need to add the <code class="language-plaintext highlighter-rouge">attempts:n</code> option so that you retry a query as many times as possible but the total time to resolve a name, irrelevant of success or failure, takes less than <strong>5</strong> seconds.  What should the value of n be?</p>
  </li>
</ul>
      <h1 id="exercises">
        
        
          <a href="#exercises" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exercises
        
        
      </h1>
    

<p>Now, let‚Äôs <del>break things</del> do some experimentation! Remember to submit your answers to Gradescope when you‚Äôre done. <strong>(Also, don‚Äôt forget to submit the checkpoint questions from the sections above!)</strong></p>

<p>The files for these exercises can be found in the <a href="https://github.com/0xcf/decal-labs">decal-labs</a> repository. Clone it now: <code class="language-plaintext highlighter-rouge">git clone https://github.com/0xcf/decal-labs</code></p>

<!-- This is a legacy link from fa18. It might be useful as reference. -->
      <h2 id="-this-is-fine-">
        
        
          <a href="#-this-is-fine-" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> üî• This is fine üî•
        
        
      </h2>
    
<p>This section will have you thinking like a sysadmin.</p>
      <h3 id="important-note">
        
        
          <a href="#important-note" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> IMPORTANT NOTE
        
        
      </h3>
    
<p><strong>Do not run the scripts directly in your student VM!</strong> These scripts are <strong>dangerous</strong> and will brick your VM so <strong>please follow the provided setup instructions.</strong> However, if you have physical access (or out-of-band management access) to a Linux machine, feel free to run the scripts directly and reboot when necessary, as all changes made are temporary.</p>

<p>Each script might make changes to your network stack with the intent of damaging your machine‚Äôs connectivity. To confine the scope of the ‚Äòattacks‚Äô, scripts will specifically try to alter your connectivity to <code class="language-plaintext highlighter-rouge">google.com</code> and <code class="language-plaintext highlighter-rouge">ocf.berkeley.edu</code>.</p>
      <h3 id="setup">
        
        
          <a href="#setup" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setup
        
        
      </h3>
    

<ol>
  <li>If you haven‚Äôt already, ssh into your student VM (<code class="language-plaintext highlighter-rouge">username@username.decal.xcf.sh</code>) and clone <a href="https://github.com/0xcf/decal-labs">decal-labs</a>.</li>
  <li>Go into the vm directory: <code class="language-plaintext highlighter-rouge">cd decal-labs/a6/vm</code></li>
  <li>Make sure the decal labs repo is up to date: <code class="language-plaintext highlighter-rouge">git pull origin master</code>.</li>
  <li>Get Virtualbox: <code class="language-plaintext highlighter-rouge">sudo apt install virtualbox</code></li>
  <li>Get Vagrant: <code class="language-plaintext highlighter-rouge">curl -O https://releases.hashicorp.com/vagrant/2.2.18/vagrant_2.2.18_x86_64.deb</code> then <code class="language-plaintext highlighter-rouge">sudo apt install ./vagrant_2.2.18_x86_64.deb</code></li>
  <li>Get Ansible: <code class="language-plaintext highlighter-rouge">sudo apt install ansible</code></li>
  <li>Start a Vagrant instance: <code class="language-plaintext highlighter-rouge">vagrant up</code></li>
  <li>Enter your Vagrant instance: <del><code class="language-plaintext highlighter-rouge">ssh vagrant@192.168.42.42</code></del><code class="language-plaintext highlighter-rouge">ssh vagrant@192.168.56.56</code>. The default password is <code class="language-plaintext highlighter-rouge">vagrant</code>. <strong>Update: If you‚Äôre running into issues with Vagrant, re-pull the git repository and try the updated command.</strong></li>
  <li>The <code class="language-plaintext highlighter-rouge">decal-labs</code> repo should be available in the Vagrant instance. If it isn‚Äôt there, you can <code class="language-plaintext highlighter-rouge">sudo apt install git</code> then clone it again.</li>
  <li><code class="language-plaintext highlighter-rouge">cd decal-labs/a6/scenario</code>.</li>
</ol>
      <h3 id="problem-instructions">
        
        
          <a href="#problem-instructions" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Problem Instructions
        
        
      </h3>
    

<p>There should be 6 scripts, named <code class="language-plaintext highlighter-rouge">1.py</code> to <code class="language-plaintext highlighter-rouge">6.py</code>. Your task is to <strong>choose at least 3 of these to run and attempt to fix the problem that they cause (if any).</strong></p>

<p>Launch each script with sudo, i.e. <code class="language-plaintext highlighter-rouge">sudo python3 &lt;script.py&gt;</code>.</p>

<p>For each script, follow this two step process.  <strong>Only move onto another script once you have finished resolving your current one.</strong></p>

<ol>
  <li>
    <p>Analyze whether or not your connectivity has been damaged. If your stack has been damaged identify the issue or which part of your network is no longer functioning as intended.</p>
  </li>
  <li>
    <p>If you concluded there was a problem, resolve the issue.  What commands did you use and how did you conclude things were fully functional again?</p>

    <p><strong>Additionally, for each step you must explain the tools you used and how you came to your  conclusions i.e.</strong></p>

    <blockquote>
      <p>I ran <code class="language-plaintext highlighter-rouge">example --pls --fix computer</code> and I noticed that line 3: <code class="language-plaintext highlighter-rouge">computer-is-broken</code> meant my machine was f*****.</p>
    </blockquote>

    <blockquote>
      <p>This script damaged my ability to connect to google.com by poisoning my arp cache with bogus entries.</p>
    </blockquote>
  </li>
</ol>
      <h3 id="debugging-bank">
        
        
          <a href="#debugging-bank" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging Bank
        
        
      </h3>
    

<p><strong>I can‚Äôt ssh into my Vagrant instance!</strong></p>
<ul>
  <li>You might need to run <code class="language-plaintext highlighter-rouge">vagrant provision</code> and then re-run <code class="language-plaintext highlighter-rouge">vagrant up</code>.</li>
  <li>Also, make sure you‚Äôre running <code class="language-plaintext highlighter-rouge">ssh 192.168.42.42</code> and not <code class="language-plaintext highlighter-rouge">vagrant ssh</code>.</li>
</ul>

<p><strong>I accidentally bricked something, how do I reset my Vagrant instance?</strong></p>
<ul>
  <li>Run <code class="language-plaintext highlighter-rouge">vagrant destroy</code> and then <code class="language-plaintext highlighter-rouge">vagrant up</code> in the <code class="language-plaintext highlighter-rouge">vm</code> folder.</li>
</ul>

<p><strong>I‚Äôve tried running <code class="language-plaintext highlighter-rouge">vagrant provision</code> a bunch of times and it never seems to work :(</strong></p>
<ul>
  <li>As an alternative to installing Vagrant on your student VM, you can also try <a href="https://www.vagrantup.com/downloads">installing it on your local machine</a>.</li>
</ul>

<p><strong>I accidentally ran the scripts in my student VM and not in the Vagrant instance and now I can‚Äôt log in. What do I do?</strong></p>
<ul>
  <li>You‚Äôll need to ask us to reset your VM. Contact us in #decal-general or over email to arrange this.</li>
</ul>
      <h2 id="net-ninjas-optional">
        
        
          <a href="#net-ninjas-optional" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Net Ninjas (Optional)
        
        
      </h2>
    
<p><strong>Run this in your Vagrant instance. The file should be found in <code class="language-plaintext highlighter-rouge">decal-labs/a6/</code>.</strong></p>
<ol>
  <li>The ninja has spent a few years training in a dojo and has mastered fireball (<code class="language-plaintext highlighter-rouge">ÁÅ´ÁêÉ</code>) jutsu.  He can use his new skills to tamper with your network stack, incinerating your attempts to catch him.  Run <code class="language-plaintext highlighter-rouge">sudo python3 advanced_ninja_port.py</code>.  Fix the damage he has done and then successfully send him a <code class="language-plaintext highlighter-rouge">found you</code> message!</li>
</ol>

        
        <hr>
        <footer>
  <div class="col-lg-12 text-center">
    <p>
      <a href="https://www.digitalocean.com" class="no-underline">
        <img
          src="/archives/2022-spring/assets/images/digitalocean.png"
          style="height: 34px; width: 200px"
      /></a>
      <span>
        With great appreciation to
        <a href="https://www.digitalocean.com">DigitalOcean</a> for sponsoring
        the VMs used in both tracks of the DeCal
      </span>
    </p>
    <p>
      <a href="https://www.linode.com" class="no-underline">
        <img
          src="/archives/2022-spring/assets/images/linode.png"
          style="height: 50px; width: 125px"
        />
      </a>
      <span>
        Huge thanks to
        <a href="https://www.linode.com">Linode</a> for sponsoring the equipment
        used to record digital lectures for the Decal
      </span>
    </p>
    <p>
      <a href="https://www.ocf.berkeley.edu" class="no-underline">
        <img
          src="https://www.ocf.berkeley.edu/hosting-logos/ocf-hosted-penguin.svg"
          alt="Hosted by the OCF"
          style="border: 0"
      /></a>
      <span>
        Copyright &copy; 2017-2021
        <a href="https://www.ocf.berkeley.edu"> Open Computing Facility </a>
        and
        <a href="https://xcf.berkeley.edu"> eXperimental Computing Facility </a>
      </span>
    </p>
    <p>
      <span>
        This website and its course materials are licensed under the terms of the
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
          CC BY-NC-SA 4.0
        </a>
        License.
        <a href="https://github.com/0xcf/decal-web/"> Source Code </a>
        available on GitHub
      </span>
    </p>
  </div>
  <!-- /.col-lg-12 -->
</footer>

      </div>
    </div>
  </div>

  <script>
    function setCookie(cname, cvalue, exdays) {
      const d = new Date();
      d.setTime(d.getTime() + (exdays*24*60*60*1000));
      let expires = "expires="+ d.toUTCString();
      document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      let ca = decodedCookie.split(';');
      for(let i = 0; i <ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    document.getElementById("loading").style["backgroundColor"] = getCookie("dark-mode") == 1 ? "#27262b" : "#ffffff" // Set the opaque layer to the prefered color

    window.addEventListener('load', (event) => {
      document.getElementById("loading").style = ""; // Remove the opaque layer when the page loads
    });


    let dark = !(window.matchMedia && 
    window.matchMedia('(prefers-color-scheme: dark)').matches); // Flip dark so we can run one toggle on load
    
    let preference = getCookie("dark-mode");

    if(preference == "1") {
      dark = false;
    } else if(preference == "0") {
      dark = true;
    }

    let toggleDark = () => { 
      jtd.setTheme(dark ? 'light' : 'dark'); 

      // Change input text placeholder text color

      const PLACEHOLDER_TEXT_COLOR = "#959396";

      if(!dark) {
        let placeholderStyleElem = document.head.appendChild(document.createElement("style"));
        placeholderStyleElem.id = "placeholderTextStyle"
        placeholderStyleElem.innerHTML = "::placeholder { color: " + PLACEHOLDER_TEXT_COLOR + "; opacity: 1 }\n"; // Firefox requires opacity
        placeholderStyleElem.innerHTML += ":-ms-input-placeholder { color: " + PLACEHOLDER_TEXT_COLOR + "; }\n"; // IE 10+
        placeholderStyleElem.innerHTML += "::-ms-input-placeholder { color: " + PLACEHOLDER_TEXT_COLOR + "; }\n"; // Edge
      } else {
        let placeholderStyleElem = document.getElementById("placeholderTextStyle");
        if(placeholderStyleElem) placeholderStyleElem.remove();
      }

      setCookie("dark-mode", dark ? "0" : "1", 3652); 
      dark = !dark;
    }
    toggleDark();
  </script>
</body>
</html>

